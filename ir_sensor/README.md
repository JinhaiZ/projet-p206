## Background Knowledge

### OpenCV version

The version of OpenCV used in the Odroid is 2.3, the offical document is [here](https://docs.opencv.org/2.3)

### check OpenCV version of a system

On Ubuntu and other Debian-derived platforms, dpkg is the typical way to get software package versions.

```
dpkg -l | grep libopencv
```

If you have the development packages installed, like libopencv-core-dev, you'll probably have .pc files and can use pkg-config:

```
pkg-config --modversion opencv
```

credit: [Find OpenCV Version Installed on Ubuntu](https://stackoverflow.com/a/12536170/6783021)

### Image format

```c++
Mat m=Mat(60, 80, CV_8U, img);
```

CV_8U is unsigned 8bit/pixel - ie a pixel can have values 0-255, this is the normal range for most image and video formats.

### How to compile

#### g++ can be used to compile a simple cpp program

```
g++ inputfile.cpp -o outputbinary
```

#### While for OpenCV project, it's way more better to use a Makefile

Here is a basic Makefile example to compile OpenCV project

```Makefile

CFLAGS = -Wall
SRCS = test.cpp

LIB_DIR =/usr/include/opencv2/

EXEC_NAME = test
CC = g++
INCLUDES =


OPENCV = `pkg-config opencv --cflags --libs`
LIBS = $(OPENCV)

OBJ_FILES = main.o

all: $(EXEC_NAME)

clean:
	rm $(EXEC_NAME) $(OBJ_FILES)

$(EXEC_NAME) : $(OBJ_FILES)
	$(CC) $(CFLAGS) -I $(LIB_DIR) -o $(EXEC_NAME) $(OBJ_FILES) $(LIBS)

test.o: main.cpp
	$(CC) $(CFLAGS) -I $(LIB_DIR) -c main.cpp $(LIBS)

%.o: %.hpp
	$(CC) $(CFLAGS) $(INCLUDES) -o $@ -c $<

%.o: %.cpp
	$(CC) $(CFLAGS) $(INCLUDES) -o $@ -c $<

%.o: %.cc
	$(CC) $(CFLAGS) $(INCLUDES) -o $@ -c $<

%.o: %.c
	gcc $(CFLAGS) $(INCLUDES) -o $@ -c $<


```


## Record image frame to disk

```c++
int sequence = 0;
while(true) {
    GetDataFromSpi(&cvMat);

    std::ostringstream filename;
    filename << "./save/pic-" << sequence++ << ".bmp";
    std::string fileName = filename.str();
    imwrite(fileName, cvMat);

    std::ostringstream debug;
    debug << "saved: " << filename.str() << "\n";
    std::cout << debug.str();
}
```

## How to use built-in Background Substractor

```c
#include "opencv2/video/background_segm.hpp"
#include "opencv2/opencv.hpp"
#include "opencv2/core/core.hpp"
#include <stdio.h>
```

```c
//before while loop
  Mat fgMaskMOG; //fg mask generated by MOG method
  Mat fgMaskMOG2; //fg mask fg mask generated by MOG2 method
  
  Ptr<cv::BackgroundSubtractor> pMOG; //MOG Background subtractor
  Ptr<cv::BackgroundSubtractor> pMOG2; //MOG2 Background subtractor

  pMOG = new BackgroundSubtractorMOG();
  pMOG2 = new BackgroundSubtractorMOG2();
  
  Mat element = getStructuringElement(MORPH_RECT, Size(3, 3), Point(1,1) );

  // in the while loop
  while(true) {
    GetDataFromSpi(&cvMat);

    //unconditional loop
    pMOG->operator()(cvMat, fgMaskMOG);
    pMOG2->operator()(cvMat, fgMaskMOG2);

    imshow("Origin", cvMat);
    imshow("MOG", fgMaskMOG);
    imshow("MOG2", fgMaskMOG2);
  }
```